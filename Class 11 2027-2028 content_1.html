<!DOCTYPE html>
<html lang="en">
<head>
  <title>Chronex Classes - Physical World</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#e8d4f3">
  <link rel="manifest" href="manifest.json">
  <meta name="msapplication-TileColor" content="#e8d4f3">
  <link rel="icon" type="image/png" href="Logo_2.png?v=20251015" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #fffaf0; font-family: 'Inter', sans-serif; margin: 0; padding: 0; color: #333; }
    header { background-color: #e8d4f3; padding: 10px 20px 6px 20px; margin: 10px 10px 0 10px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; position: sticky; top: 0; z-index: 1000; transition: all 0.3s ease-in-out; }
    header img { height: 50px; background-color: #7851a9; border-radius: 50%; width: 50px; transition: transform 0.2s; }
    header img:hover { transform: scale(1.05); }
    header h2 { margin: 0 0 0 10px; font-size: 22px; font-weight: bold; color: #7851a9; }
    nav { display: flex; align-items: center; gap: 18px; flex-wrap: wrap; }
    nav a { text-decoration: none; color: #7851a9; font-weight: 600; padding: 6px 14px; border-radius: 6px; transition: background-color 0.2s, transform 0.2s; }
    nav a:hover, nav a.active { background-color: #fffaf0; transform: translateY(-1px); }
    .hamburger { display: none; flex-direction: column; cursor: pointer; gap: 5px; padding: 5px; border-radius: 4px; background-color: #7851a9; transition: background-color 0.3s; }
    .hamburger div { width: 25px; height: 3px; background-color: #fffaf0; border-radius: 2px; transition: all 0.3s ease-in-out; }
    .hamburger.open div:nth-child(1) { transform: translateY(8px) rotate(45deg); }
    .hamburger.open div:nth-child(2) { opacity: 0; }
    .hamburger.open div:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }
    .mobile-menu { display: flex; flex-direction: column; max-height: 0; opacity: 0; overflow: hidden; transition: max-height 0.4s ease-in-out, opacity 0.3s ease-in-out; position: absolute; top: 70px; right: 10px; background-color: #e8d4f3; border: 1px solid #7851a9; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); width: calc(100% - 20px); z-index: 999; padding: 0; }
    .mobile-menu.active { max-height: 300px; opacity: 1; padding: 10px 0; }
    @media (max-width: 768px) { nav { display: none; } .hamburger { display: flex; } .mobile-menu a { padding: 10px 20px; color: #7851a9; text-decoration: none; font-weight: 600; transition: background-color 0.2s, padding-left 0.2s; } .mobile-menu a:hover, .mobile-menu a.active { background-color: #fffaf0; padding-left: 25px; } }
    .progress-bar-container { background: #f3eafc; border-radius: 20px; overflow: hidden; height: 14px; margin-top: 10px; }
    .progress-bar { background: linear-gradient(90deg, #7851a9, #5a3a7c); height: 100%; width: 0%; transition: width 0.5s ease-in-out; }
    .progress-text { text-align: center; color: #5a3a7c; font-weight: 600; margin-top: 8px; }
    .study-card.completed { border-top-color: #16a34a !important; box-shadow: 0 0 20px rgba(34,197,94,0.3); transition: all 0.3s ease-in-out; }
    footer { background-color: #7851a9; color: white; text-align: center; padding: 12px; margin-top: 40px; font-size: 14px; }
    
    /* Landscape video wrapper */
    .video-wrapper {
      position: relative;
      width: 100%;
      max-width: 95vw;
      padding-top: 56.25%; /* 16:9 ratio */
      margin: auto;
    }
    .video-wrapper iframe {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      border-radius: 12px;
    }

    .close-btn { position: absolute; top: 10px; right: 10px; font-size: 2rem; color: white; background: rgba(0,0,0,0.5); border: none; border-radius: 50%; width: 50px; height: 50px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.3s; z-index: 10001; }
    .close-btn:hover { background: rgba(0,0,0,0.7); }
  </style>
</head>
<body>

<header>
  <div class="flex items-center">
    <img src="Logo_2.png?v=20251015" alt="Chronex Classes Logo" />
    <h2>Chronex Classes</h2>
  </div>
  <div class="hamburger" onclick="toggleMenu()">
    <div></div><div></div><div></div>
  </div>
  <nav><a href="Class 11 2027-2028 chapters.html">Chapters</a></nav>
  <div id="mobileMenu" class="mobile-menu">
    <a href="Class 11 2027-2028 chapters.html">Chapters</a>
  </div>
</header>

<main class="max-w-6xl mx-auto p-4 sm:p-6 mt-6">
  <h1 class="text-3xl sm:text-4xl font-extrabold text-[#7851a9] mb-3 text-center border-b-4 border-[#e8d4f3] pb-3">Physical World</h1>

  <!-- Lecture data container: JS will fill this based on data attributes -->
  <div 
    id="lecture-container" 
    class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8"
    data-class="11" 
    data-batch="2027-2028"
    data-chapter="Physical World">
    
    <p class="text-gray-500 col-span-full">Fetching lectures...</p> 
  </div>

</main>

<div id="fullscreen-player" class="fixed inset-0 z-[9999] bg-black bg-opacity-90 hidden">
  <div class="video-container relative" onclick="event.stopPropagation()">
    <button class="close-btn" onclick="closeFullscreen()">&times;</button>
    <div id="video-iframe-container" class="w-full h-full"></div>
  </div>
</div>

<footer>&copy; <span id="year"></span> Chronex Classes. All rights reserved.</footer>

<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  function toggleMenu() {
    document.getElementById('mobileMenu').classList.toggle('active');
    document.querySelector('.hamburger').classList.toggle('open');
  }

  // --- EXISTING YOUTUBE PLAYER AND PROGRESS TRACKING LOGIC ---
  const progressData = JSON.parse(localStorage.getItem('chronex_video_progress')) || {};
  let progressInterval = null; 

  function initProgress(lectureId, isChecked) {
    const data = progressData[lectureId] || {percent:0, time:0};
    const percent = data.percent || 0;
    const progressBar = document.getElementById('progressBar'+lectureId);
    const progressText = document.getElementById('progressText'+lectureId);
    const checkbox = document.querySelector(`.lecture-checkbox[data-lecture='${lectureId}']`);
    const card = document.querySelector(`.study-card[data-lecture-id='${lectureId}']`);

    if(progressBar) progressBar.style.width = percent + '%';
    if(progressText) progressText.textContent = percent + '% Watched';
    
    if(checkbox){
        checkbox.checked = isChecked || (percent >= 100);
        checkbox.addEventListener('change', (e) => {
            if(e.target.checked) {
                 card.classList.add('completed');
                 progressData[lectureId] = {percent: 100, time: progressData[lectureId]?.time || 0};
                 localStorage.setItem('chronex_video_progress', JSON.stringify(progressData));
                 if(progressBar) progressBar.style.width = '100%';
                 if(progressText) progressText.textContent = '100% Watched';
            } else {
                 card.classList.remove('completed');
            }
        });
    }

    if(card && checkbox.checked){
      card.classList.add('completed');
    }
  }
  
  // This function is called by lecture_automator.js after it inserts the new cards.
  window.reinitializeProgress = function(filteredLectures) {
    filteredLectures.forEach((lecture, index) => {
      // lectureId is index + 1
      initProgress(index + 1, false); 
    });
  }


  function openFullscreen(videoId, lectureId) {
    const player = document.getElementById('fullscreen-player');
    const iframeContainer = document.getElementById('video-iframe-container');

    // Stop any existing interval
    if(progressInterval) clearInterval(progressInterval);

    const lastProgress = progressData[lectureId] || {percent:0, time:0};
    const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&enablejsapi=1&controls=1&showinfo=0&iv_load_policy=3&playlist=${videoId}&start=${Math.floor(lastProgress.time)}`;
    
    iframeContainer.innerHTML = `<div class="video-wrapper"><iframe id='ytplayer' src='${embedUrl}' frameborder='0' allow='autoplay; encrypted-media' allowfullscreen></iframe></div>`;
    player.classList.remove('hidden');
    document.body.style.overflow = 'hidden';

    // Load YouTube API script if not present
    if(!window.YT){
      const tag = document.createElement('script');
      tag.src = 'https://www.youtube.com/iframe_api';
      document.body.appendChild(tag);
    }

    window.onYouTubeIframeAPIReady = function(){
      const ytPlayer = new YT.Player('ytplayer', {
        events: {
          'onStateChange': function(event){
            const videoDuration = event.target.getDuration();
            if(event.data === YT.PlayerState.PLAYING){
              progressInterval = setInterval(() => {
                const currentTime = event.target.getCurrentTime();
                const percent = Math.min(100, Math.round((currentTime / videoDuration) * 100)); // Cap at 100
                
                const progressBar = document.getElementById('progressBar'+lectureId);
                const progressText = document.getElementById('progressText'+lectureId);
                const checkbox = document.querySelector(`.lecture-checkbox[data-lecture='${lectureId}']`);
                const card = document.querySelector(`.study-card[data-lecture-id='${lectureId}']`);

                if(progressBar) progressBar.style.width = percent + '%';
                if(progressText) progressText.textContent = percent + '% Watched';

                progressData[lectureId] = {percent: percent, time: currentTime};
                localStorage.setItem('chronex_video_progress', JSON.stringify(progressData));

                if(checkbox && percent >= 100){
                  checkbox.checked = true;
                  if (card) card.classList.add('completed');
                  clearInterval(progressInterval);
                }

              }, 1000); // Update every second
            } else {
              clearInterval(progressInterval);
            }
          }
        }
      });
    }
  }

  function closeFullscreen() {
    const player = document.getElementById('fullscreen-player');
    document.getElementById('video-iframe-container').innerHTML = '';
    player.classList.add('hidden');
    document.body.style.overflow = 'auto';
    if(progressInterval) clearInterval(progressInterval);
  }

  document.addEventListener('keydown', e => {
    if(e.key === 'Escape' && !document.getElementById('fullscreen-player').classList.contains('hidden')){
      closeFullscreen();
    }
  });

</script>

<!-- FINAL STEP: Load the automation script -->
<script src="lecture_automator.js"></script>

</body>
</html>
